ğŸš€ Day 20 of #100DaysOfDevOps with #KodeKloud ğŸš€

Today's challenge: Configuring NGINX + PHP-FPM Using a Unix Socket

What I Built:
ğŸ”¹ Installed NGINX and PHP-FPM 8.3 on the app server
ğŸ”¹ Configured custom port (8092) and document root (/var/www/html)
ğŸ”¹ Set up PHP-FPM to use Unix socket: /var/run/php-fpm/default.sock
ğŸ”¹ Created an upstream block for cleaner socket management:

upstream php-fpm {
    server unix:/var/run/php-fpm/default.sock;
}

ğŸ”¹ Configured NGINX to handle PHP requests:

location ~ \.php$ {
    try_files $uri =404;
    fastcgi_pass php-fpm;
    fastcgi_index index.php;
    fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
    include fastcgi_params;
}

ğŸ”¹ Successfully tested with curl http://stapp02:8092/index.php âœ…

ğŸ’¡ Key Takeaways:

âœ… Unix sockets > TCP/IP for same-machine communication â€” faster, more secure, zero network overhead

âœ… try_files $uri =404; protects PHP-FPM from processing non-existent or malicious files

âœ… Upstream blocks provide better abstraction and prevent 502 errors during PHP-FPM restarts

âœ… SCRIPT_FILENAME is critical â€” without it, PHP-FPM doesn't know which file to execute

âœ… Understanding the nginx â†’ php-fpm â†’ socket flow is essential for debugging web stack issues

ğŸ› Challenges I Faced:

Initially struggled with 404 errors due to incorrect document root configuration. Learned the importance of:
- Verifying file paths and permissions
- Checking service names (it's php-fpm, not php83-php-fpm!)
- Testing locally before remote testing

ğŸ“˜ Resources that helped:
- https://github.com/kodekloudhub/community-faq/blob/main/docs/kodekloud-engineer/level-4/linux/09-nginx-php-fpm-linux-sock.md
- https://wiki.crowncloud.net/?How_to_Install_PHP_8_2_in_CentOS_9_Stream
- https://reintech.io/blog/setting-up-php-fpm-centos-9

Another day, another lesson learned! ğŸ¯

#DevOps #Linux #NGINX #SystemAdministration #CentOS 